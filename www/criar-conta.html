<!-- Wappler include head-page="index.html" is="dmx-app" id="criarconta" appConnect="local" bootstrap5="local" capacitor="local" components="{dmxBootstrap5Alert:{},dmxBrowser:{},dmxFormatter:{}}" -->
<dmx-value id="etapas" dmx-bind:value="0"></dmx-value>
<dmx-value id="total_etapas" dmx-bind:value="3"></dmx-value>
<dmx-bootstrap5-alert id="notificacoes">
</dmx-bootstrap5-alert>
<script src="js/masks.js"></script>

<div class="container-fluid vh-100 p-5 bg-login">
    <div class="row h-100">
        <div class="col-lg-6 d-none d-lg-block">
            <div class="d-flex h-100 justify-content-center align-items-center">
                <div class="col-8"></div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="d-flex flex-column h-100 justify-content-center align-items-center">
                <header class="mb-4">
                    <img src="assets/images/spacefeed-black.png" class="img-fluid" width="240" alt="Spacefeed Logo">
                </header>
                <main class="w-100 d-flex justify-content-center mb-4">
                    <div class="col-12 col-sm-11 col-md-10 col-lg-12 col-xl-11 col-xxl-10 p-4 p-md-5 p-lg-6 glass-background-solid">
                        <div class="text-center mb-4">
                            <h1 class="h3 mb-2">Criar Conta</h1>
                            <p class="h6 text-muted mb-0">Preencha o formulário abaixo para criar sua conta.</p>
                        </div>

                        <form id="criar_conta_form" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/nova-conta" site="backendMarte" dmx-on:error="notificacoes.error('Erro ao criar a conta. Tente novamente.')">

                            <!-- Step 1: Dados da Empresa -->
                            <div class="wizard-step-content" id="step-1" dmx-show="etapas.value == 0">
                                <h5 class="mb-3">Informações da Empresa</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="razao_social" class="form-label">Razão Social</label>
                                            <input type="text" class="form-control" id="razao_social" name="razao_social" required data-msg-required="Por favor, informe a razão social.">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="nome_fantasia" class="form-label">Nome Fantasia</label>
                                            <input type="text" class="form-control" id="nome_fantasia" name="nome_fantasia" required data-msg-required="Por favor, informe o nome fantasia.">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="nome_polo" class="form-label">Nome do Polo</label>
                                            <input type="text" class="form-control" id="nome_polo" name="nome_polo" required data-msg-required="Por favor, informe o nome do polo.">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="cnpj" class="form-label">CNPJ</label>
                                            <input type="text" class="form-control" id="cnpj" name="cnpj" placeholder="XX.XXX.XXX/XXXX-XX" required data-msg-required="Por favor, informe um CNPJ válido.">
                                            <small id="bs5-form-group-help1" class="form-text text-danger" dmx-show="criar_conta_form.data.resposta=='Este CNPJ já esta cadastrado!'">{{criar_conta_form.data.resposta}}</small>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-2">
                                            <label for="whatsapp" class="form-label">WhatsApp</label>
                                            <input type="text" class="form-control" id="whatsapp" name="whatsapp" placeholder="(XX) XXXXX-XXXX" required data-msg-required="Por favor, informe um WhatsApp válido.">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: Endereço da Empresa -->
                            <div class="wizard-step-content" id="step-2" dmx-show="etapas.value == 1">
                                <h5 class="mb-3">Endereço da Empresa</h5>
                                <div class="row g-3">
                                    <div class="col-12">
                                        <div class="form-group mb-2">
                                            <label for="endereco" class="form-label">Endereço (Logradouro)</label>
                                            <input type="text" class="form-control" id="endereco" name="endereco" required data-msg-required="Por favor, informe o endereço.">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group mb-2">
                                            <label for="numero" class="form-label">Número</label>
                                            <input type="text" class="form-control" id="numero" name="numero" required data-msg-required="Por favor, informe o número.">
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="form-group mb-2">
                                            <label for="cep" class="form-label">CEP</label>
                                            <input type="text" class="form-control" id="cep" name="cep" placeholder="XXXXX-XXX" required data-msg-required="Por favor, informe um CEP válido.">
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-2">
                                            <label for="complemento" class="form-label">Complemento <small class="text-muted">(opcional)</small></label>
                                            <input type="text" class="form-control" id="complemento" name="complemento" placeholder="Sala, bloco, referência...">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="bairro" class="form-label">Bairro</label>
                                            <input type="text" class="form-control" id="bairro" name="bairro" required data-msg-required="Por favor, informe o bairro.">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="cidade" class="form-label">Cidade</label>
                                            <input type="text" class="form-control" id="cidade" name="cidade" required data-msg-required="Por favor, informe a cidade.">
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-2">
                                            <label for="uf" class="form-label">Estado</label>
                                            <select class="form-select" id="uf" name="uf" required data-msg-required="Por favor, selecione o estado.">
                                                <option value="" selected disabled>Selecione o estado...</option>
                                                <option value="AC">Acre</option>
                                                <option value="AL">Alagoas</option>
                                                <option value="AP">Amapá</option>
                                                <option value="AM">Amazonas</option>
                                                <option value="BA">Bahia</option>
                                                <option value="CE">Ceará</option>
                                                <option value="DF">Distrito Federal</option>
                                                <option value="ES">Espírito Santo</option>
                                                <option value="GO">Goiás</option>
                                                <option value="MA">Maranhão</option>
                                                <option value="MT">Mato Grosso</option>
                                                <option value="MS">Mato Grosso do Sul</option>
                                                <option value="MG">Minas Gerais</option>
                                                <option value="PA">Pará</option>
                                                <option value="PB">Paraíba</option>
                                                <option value="PR">Paraná</option>
                                                <option value="PE">Pernambuco</option>
                                                <option value="PI">Piauí</option>
                                                <option value="RJ">Rio de Janeiro</option>
                                                <option value="RN">Rio Grande do Norte</option>
                                                <option value="RS">Rio Grande do Sul</option>
                                                <option value="RO">Rondônia</option>
                                                <option value="RR">Roraima</option>
                                                <option value="SC">Santa Catarina</option>
                                                <option value="SP">São Paulo</option>
                                                <option value="SE">Sergipe</option>
                                                <option value="TO">Tocantins</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: Dados do Usuário -->
                            <div class="wizard-step-content" id="step-3" dmx-show="etapas.value == 2">
                                <h5 class="mb-3">Dados do Usuário</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="nome_completo" class="form-label">Nome Completo</label>
                                            <input type="text" class="form-control" id="nome_completo" name="nome_completo" required data-msg-required="Por favor, informe o nome completo.">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="nome_tratamento" class="form-label">Nome de Tratamento</label>
                                            <input type="text" class="form-control" id="nome_tratamento" name="nome_tratamento" placeholder="Como você gostaria de ser chamado(a)" required data-msg-required="Por favor, informe o nome de tratamento.">
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-2">
                                            <label for="email" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="email" name="email" required data-msg-required="Por favor, informe um email válido." data-rule-email="true" data-msg-email="Por favor, informe um email válido.">
                                            <small id="bs5-form-group-help2" class="form-text text-danger" dmx-show="criar_conta_form.data.resposta=='Este e-mail já esta cadastrado!'">{{criar_conta_form.data.resposta}}</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="senha" class="form-label">Senha</label>
                                            <input type="password" class="form-control" id="senha" name="senha" required minlength="8" data-msg-required="A senha é obrigatória." data-msg-minlength="A senha deve ter pelo menos 8 caracteres.">
                                            <div class="form-text">Mínimo 8 caracteres com pelo menos 1 minúscula, 1 maiúscula e 1 número.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-2">
                                            <label for="confirmar_senha" class="form-label">Confirmar Senha</label>
                                            <input type="password" class="form-control" id="confirmar_senha" name="confirmar_senha" required data-rule-equalto="#senha" data-msg-required="Por favor, confirme a senha." data-msg-equalto="As senhas não coincidem.">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: Plano e Confirmação -->
                            <div class="wizard-step-content" id="step-4" dmx-show="etapas.value == 3">
                                <h5 class="mb-3">Plano e Confirmação</h5>
                                <div class="row g-3">
                                    <div class="col-12">
                                        <p class="text-muted">Você está se cadastrando no <strong>Plano Beta</strong> - gratuito até o lançamento da versão oficial.</p>
                                    </div>
                                    <div class="col-12 mt-3">
                                        <div class="form-group">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="aceitar_termos" name="aceitar_termos" value="1" required data-msg-required="Você deve aceitar os termos para continuar.">
                                                <input type="hidden" name="plano" value="beta">
                                                <label class="form-check-label" for="aceitar_termos">
                                                    Eu aceito os <a href="#" class="text-decoration-none">Termos de Uso</a> e a <a href="#" class="text-decoration-none">Política de Privacidade</a> do Plano Beta
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Navigation Controls -->
                            <div class="d-flex justify-content-between align-items-center mt-4">
                                <!-- Botão Voltar -->
                                <button type="button" class="btn btn-warning" dmx-show="etapas.value &gt; 0" dmx-on:click="etapas.setValue(etapas.value - 1)">
                                    <i class="bi bi-arrow-left me-1"></i>
                                    Voltar
                                </button>

                                <!-- Indicador de Progresso -->
                                <div class="text-center">
                                    <small class="text-muted">Etapa <span dmx-text="etapas.value + 1"></span> de 4</small>
                                </div>

                                <!-- Botão Próximo/Finalizar -->
                                <div>
                                    <!-- Botão Próximo (etapas 0-2) -->
                                    <button type="button" class="btn btn-primary" dmx-show="etapas.value < 3" dmx-on:click="etapas.setValue(etapas.value + 1)">
                                        Próximo
                                        <i class="bi bi-arrow-right ms-1"></i>
                                    </button>

                                    <!-- Botão Criar Conta (etapa 3) -->
                                    <button class="btn btn-success" dmx-show="etapas.value == 3" dmx-on:click="run([{run:{outputType:'text',action:`criar_conta_form.submit()`}},{wait:{delay:2000}},{condition:{outputType:'boolean',if:`criar_conta_form.data.resposta.contains(\'Conta criada com sucesso!\', false)`,then:{steps:[{run:{outputType:'text',action:`notificacoes.success(\'Sua conta foi criada com sucesso! Seja bem-vindo(a)!\')`}},{wait:{delay:4500}},{run:{outputType:'text',action:`navegacao.goto(\'/\',true)`}}]}}},{condition:{outputType:'boolean',if:`criar_conta_form.data.resposta.contains(\'Este e-mail já esta cadastrado!\', \'false\')`,then:{steps:{run:{outputType:'text',action:`notificacoes.warning(\'Este e-mail já esta cadastrado! Utilize outro para criar uma conta ou entre em contato com o suporte!\')`}}}}},{condition:{outputType:'boolean',if:`criar_conta_form.data.resposta.contains(\'Este CNPJ já esta cadastrado!\', false)`,then:{steps:{run:{outputType:'text',action:`notificacoes.warning(\'Este CNPJ já esta cadastrado! Utilize outro para criar uma conta ou entre em contato com o suporte!\')`}}}}}])">
                                        <i class="bi bi-check-circle me-1"></i>
                                        Criar Conta
                                    </button>
                                </div>
                            </div>

                            <!-- Progress Bar -->
                            <div class="progress mt-3" style="height: 4px;">
                                <div class="progress-bar bg-success" dmx-bind:style="'width: ' + ((etapas.value + 1) / 4 * 100) + '%'" role="progressbar"></div>
                            </div>
                        </form>
                    </div>
                </main>
                <footer class="text-center px-3">
                    <p class="mini-titulo mb-0 p-1 rounded-2">© Spacefeed é uma marca registrada de RKS Tech Solution. Todos os direitos reservados.</p>
                </footer>
            </div>
        </div>
    </div>
</div>

<script>
    // Initialize masks when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    // Initialize masks if available
    setTimeout(() => {
        if (typeof window.initializeMasks === 'function') {
            window.initializeMasks();
        }
    }, 100);
});
</script>