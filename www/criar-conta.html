<!-- Wappler include head-page="index.html" is="dmx-app" id="criarconta" appConnect="local" bootstrap5="local" capacitor="local" components="{dmxBootstrap5Alert:{}}" -->
<script src="js/masks.js"></script>
<div class="container-fluid vh-100 p-5 bg-login">
    <div class="row h-100">
        <div class="col-lg-6 d-none d-lg-block">
            <div class="d-flex h-100 justify-content-center align-items-center">
                <div class="col-8"></div>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="d-flex flex-column h-100 justify-content-center align-items-center">
                <header class="mb-4">
                    <img src="assets/images/spacefeed-black.png" class="img-fluid" width="240" alt="Spacefeed Logo">
                </header>
                <main class="w-100 d-flex justify-content-center mb-4">
                    <div class="col-12 col-sm-11 col-md-10 col-lg-12 col-xl-11 col-xxl-10 p-4 p-md-5 p-lg-6 glass-background-solid">
                        <div class="text-center mb-4">
                            <h1 class="h3 mb-2">Criar Conta</h1>
                            <p class="h6 text-muted mb-0">Preencha o formulário abaixo para criar sua conta.</p>
                        </div>

                        <form id="criar_conta_form">
                            <div class="wizard-content">
                                <!-- Step 1: Dados da Empresa -->
                                <div class="wizard-step-content active" id="step-1">
                                    <h5 class="mb-3">Informações da Empresa</h5>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="razao_social" class="form-label">Razão Social</label>
                                                <input type="text" class="form-control" id="razao_social" name="razao_social">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe a razão social.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="nome_fantasia" class="form-label">Nome Fantasia</label>
                                                <input type="text" class="form-control" id="nome_fantasia" name="nome_fantasia">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe o nome fantasia.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="nome_polo" class="form-label">Nome do Polo</label>
                                                <input type="text" class="form-control" id="nome_polo" name="nome_polo">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe o nome do polo.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="cnpj" class="form-label">CNPJ</label>
                                                <input type="text" class="form-control" id="cnpj" name="cnpj" placeholder="XX.XXX.XXX/XXXX-XX">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe um CNPJ válido no formato XX.XXX.XXX/XXXX-XX.</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-group mb-2">
                                                <label for="whatsapp" class="form-label">WhatsApp</label>
                                                <input type="text" class="form-control" id="whatsapp" name="whatsapp" placeholder="(XX) XXXXX-XXXX">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe um WhatsApp válido no formato (XX) XXXXX-XXXX.</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 2: Endereço da Empresa -->
                                <div class="wizard-step-content" id="step-2">
                                    <h5 class="mb-3">Endereço da Empresa</h5>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="form-group mb-2">
                                                <label for="endereco" class="form-label">Endereço (Logradouro)</label>
                                                <input type="text" class="form-control" id="endereco" name="endereco">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe o endereço.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mb-2">
                                                <label for="numero" class="form-label">Número</label>
                                                <input type="text" class="form-control" id="numero" name="numero">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe o número.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <div class="form-group mb-2">
                                                <label for="cep" class="form-label">CEP</label>
                                                <input type="text" class="form-control" id="cep" name="cep" placeholder="XXXXX-XXX">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe um CEP válido no formato XXXXX-XXX.</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-group mb-2">
                                                <label for="complemento" class="form-label">Complemento <small class="text-muted">(opcional)</small></label>
                                                <input type="text" class="form-control" id="complemento" name="complemento" placeholder="Sala, bloco, referência...">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="bairro" class="form-label">Bairro</label>
                                                <input type="text" class="form-control" id="bairro" name="bairro">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe o bairro.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="cidade" class="form-label">Cidade</label>
                                                <input type="text" class="form-control" id="cidade" name="cidade">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe a cidade.</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-group mb-2">
                                                <label for="uf" class="form-label">Estado</label>
                                                <select class="form-select" id="uf" name="uf">
                                                    <option value="" selected disabled>Selecione o estado...</option>
                                                    <option value="AC">Acre</option>
                                                    <option value="AL">Alagoas</option>
                                                    <option value="AP">Amapá</option>
                                                    <option value="AM">Amazonas</option>
                                                    <option value="BA">Bahia</option>
                                                    <option value="CE">Ceará</option>
                                                    <option value="DF">Distrito Federal</option>
                                                    <option value="ES">Espírito Santo</option>
                                                    <option value="GO">Goiás</option>
                                                    <option value="MA">Maranhão</option>
                                                    <option value="MT">Mato Grosso</option>
                                                    <option value="MS">Mato Grosso do Sul</option>
                                                    <option value="MG">Minas Gerais</option>
                                                    <option value="PA">Pará</option>
                                                    <option value="PB">Paraíba</option>
                                                    <option value="PR">Paraná</option>
                                                    <option value="PE">Pernambuco</option>
                                                    <option value="PI">Piauí</option>
                                                    <option value="RJ">Rio de Janeiro</option>
                                                    <option value="RN">Rio Grande do Norte</option>
                                                    <option value="RS">Rio Grande do Sul</option>
                                                    <option value="RO">Rondônia</option>
                                                    <option value="RR">Roraima</option>
                                                    <option value="SC">Santa Catarina</option>
                                                    <option value="SP">São Paulo</option>
                                                    <option value="SE">Sergipe</option>
                                                    <option value="TO">Tocantins</option>
                                                </select>
                                                <div class="invalid-feedback" style="display: none;">Por favor, selecione o estado.</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 3: Dados do Usuário -->
                                <div class="wizard-step-content" id="step-3">
                                    <h5 class="mb-3">Dados do Usuário</h5>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="nome_completo" class="form-label">Nome Completo</label>
                                                <input type="text" class="form-control" id="nome_completo" name="nome_completo">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe o nome completo.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="nome_tratamento" class="form-label">Nome de Tratamento</label>
                                                <input type="text" class="form-control" id="nome_tratamento" name="nome_tratamento" placeholder="Como você gostaria de ser chamado(a)">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe o nome de tratamento.</div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-group mb-2">
                                                <label for="email" class="form-label">Email</label>
                                                <input type="email" class="form-control" id="email" name="email">
                                                <div class="invalid-feedback" style="display: none;">Por favor, informe um email válido.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="senha" class="form-label">Senha</label>
                                                <input type="password" class="form-control" id="senha" name="senha">
                                                <div class="invalid-feedback" style="display: none;">A senha deve ter pelo menos 8 caracteres, com ao menos 1 letra minúscula, 1 maiúscula e 1 número.</div>
                                                <div class="form-text">Mínimo 8 caracteres com pelo menos 1 minúscula, 1 maiúscula e 1 número.</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group mb-2">
                                                <label for="confirmar_senha" class="form-label">Confirmar Senha</label>
                                                <input type="password" class="form-control" id="confirmar_senha" name="confirmar_senha">
                                                <div class="invalid-feedback" style="display: none;">As senhas não coincidem.</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 4: Plano e Confirmação -->
                                <div class="wizard-step-content" id="step-4">
                                    <h5 class="mb-3">Plano e Confirmação</h5>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <p class="text-muted">Você está se cadastrando no <strong>Plano Beta</strong> - gratuito até o lançamento da versão oficial.</p>
                                        </div>
                                        <div class="col-12 mt-3">
                                            <div class="form-group">
                                                <div class="form-check">
                                                    <input type="checkbox" class="form-check-input" id="aceitar_termos" name="aceitar_termos" value="1">
                                                    <input type="hidden" name="plano" value="beta">
                                                    <label class="form-check-label" for="aceitar_termos">
                                                        Eu aceito os <a href="#" class="text-decoration-none">Termos de Uso</a> e a <a href="#" class="text-decoration-none">Política de Privacidade</a> do Plano Beta
                                                    </label>
                                                    <div class="invalid-feedback" style="display: none;">Você deve aceitar os termos para continuar.</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Wizard Navigation -->
                            <div class="wizard-navigation">
                                <button type="button" class="btn btn-outline-secondary" id="prevBtn" onclick="changeStep(-1)" style="display: none;">
                                    <i class="bi bi-arrow-left me-1"></i>Anterior
                                </button>
                                <div class="d-flex ms-auto">
                                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="changeStep(1)">
                                        Próximo<i class="bi bi-arrow-right ms-1"></i>
                                    </button>
                                    <button class="btn btn-success" id="submitBtn" style="display: none;" dmx-on:click="api_criar_conta.load({razao_social: razao_social.value, nome_fantasia: nome_fantasia.value, nome_polo: nome_polo.value, cnpj: cnpj.value, whatsapp: whatsapp.value, endereco: endereco.value, numero: numero.value, cep: cep.value, complemento: complemento.value, bairro: bairro.value, cidade: cidade.value, uf: uf.selectedText, nome_completo: nome_completo.value, nome_tratamento: nome_tratamento.value, email: email.value, senha: senha.value})">
                                        Criar Conta
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </main>
                <footer class="text-center px-3">
                    <p class="mini-titulo mb-0 p-1 rounded-2">© Spacefeed é uma marca registrada de RKS Tech Solution. Todos os direitos reservados.</p>
                </footer>
            </div>
        </div>
    </div>
</div>

<script>
    let currentStep = 1;
const totalSteps = 4;

function showStep(step) {
    document.querySelectorAll('.wizard-step-content').forEach(content => {
        content.classList.remove('active');
    });
    
    document.getElementById(`step-${step}`).classList.add('active');
    
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    
    if (step === 1) {
        prevBtn.style.display = 'none';
    } else {
        prevBtn.style.display = 'inline-block';
    }
    
    if (step === totalSteps) {
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'inline-block';
    } else {
        nextBtn.style.display = 'inline-block';
        submitBtn.style.display = 'none';
    }
}

function validateRequiredFields(step) {
    const requiredFields = {
        1: ['razao_social', 'nome_fantasia', 'nome_polo', 'cnpj', 'whatsapp'],
        2: ['endereco', 'numero', 'cep', 'bairro', 'cidade', 'uf'],
        3: ['nome_completo', 'nome_tratamento', 'email', 'senha', 'confirmar_senha'],
        4: ['aceitar_termos']
    };
    
    let isValid = true;
    const fieldsToValidate = requiredFields[step] || [];
    
    fieldsToValidate.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        const feedback = field.parentElement.querySelector('.invalid-feedback');
        
        let fieldValid = true;
        
        if (!field.value || field.value.trim() === '') {
            fieldValid = false;
        } else {
            if (fieldId === 'email') {
                const email = field.value;
                if (!email.includes('@') || !email.includes('.') || email.indexOf('@') < 1 || email.lastIndexOf('.') < email.indexOf('@') + 2) {
                    fieldValid = false;
                }
            }
            
            if (fieldId === 'cnpj') {
                if (field.value.length !== 18) {
                    fieldValid = false;
                }
            }
            
            if (fieldId === 'whatsapp') {
                const length = field.value.length;
                if (length !== 14 && length !== 15) {
                    fieldValid = false;
                }
            }
            
            if (fieldId === 'cep') {
                if (field.value.length !== 9) {
                    fieldValid = false;
                }
            }
            
            if (fieldId === 'senha') {
                const password = field.value;
                if (password.length < 8) {
                    fieldValid = false;
                } else {
                    let hasLower = false, hasUpper = false, hasNumber = false;
                    for (let i = 0; i < password.length; i++) {
                        const char = password[i];
                        if (char >= 'a' && char <= 'z') hasLower = true;
                        if (char >= 'A' && char <= 'Z') hasUpper = true;
                        if (char >= '0' && char <= '9') hasNumber = true;
                    }
                    if (!hasLower || !hasUpper || !hasNumber) {
                        fieldValid = false;
                    }
                }
            }
            
            if (fieldId === 'confirmar_senha') {
                const senha = document.getElementById('senha').value;
                if (field.value !== senha) {
                    fieldValid = false;
                }
            }
        }
        
        if (fieldId === 'aceitar_termos') {
            fieldValid = field.checked;
        }
        
        if (fieldValid) {
            field.classList.remove('is-invalid');
            if (feedback) feedback.style.display = 'none';
        } else {
            field.classList.add('is-invalid');
            if (feedback) feedback.style.display = 'block';
            isValid = false;
        }
    });
    
    return isValid;
}

function changeStep(direction) {
    if (direction === 1) {
        if (!validateRequiredFields(currentStep)) {
            return;
        }
    }
    
    const newStep = currentStep + direction;
    
    if (newStep >= 1 && newStep <= totalSteps) {
        currentStep = newStep;
        showStep(currentStep);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    showStep(1);
    
    if (typeof window.initializeMasks === 'function') {
        window.initializeMasks();
    } else {
        setTimeout(function() {
            if (typeof window.initializeMasks === 'function') {
                window.initializeMasks();
            }
        }, 1000);
    }
    
    document.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('is-invalid');
            const feedback = this.parentElement.querySelector('.invalid-feedback');
            if (feedback) {
                feedback.style.display = 'none';
            }
        });
        
        input.addEventListener('change', function() {
            this.classList.remove('is-invalid');
            const feedback = this.parentElement.querySelector('.invalid-feedback');
            if (feedback) {
                feedback.style.display = 'none';
            }
        });
    });
    
    document.getElementById('registration_form').addEventListener('submit', function(e) {
        let allValid = true;
        
        for (let i = 1; i <= totalSteps; i++) {
            if (!validateRequiredFields(i)) {
                allValid = false;
                if (i < currentStep) {
                    currentStep = i;
                    showStep(currentStep);
                    break;
                }
            }
        }
        
        if (!allValid) {
            e.preventDefault();
        }
    });
});
</script>