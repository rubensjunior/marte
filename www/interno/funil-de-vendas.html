<!-- Wappler include head-page="backoffice.html" is="dmx-app" id="funildevendas" appConnect="local" bootstrap5="local" capacitor="local" components="{dmxBootstrap5Modal:{},dmxValidator:{},dmxDataTraversal:{},dmxStateManagement:{}}" -->

<dmx-query-manager id="board"></dmx-query-manager>

<dmx-serverconnect id="listar_funil" url="http://localhost:3000/api/listar_funil" site="backendMarte" dmx-param:id_empresa_funil="usuario.data.query[0].empresa_selecionada"></dmx-serverconnect>
<dmx-serverconnect id="listar_time" url="http://localhost:3000/api/listar-times" site="backendMarte" dmx-param:id_empresa="usuario.data.query[0].empresa_selecionada"></dmx-serverconnect>
<dmx-data-detail id="data_funil"></dmx-data-detail>
<div class="modal" id="modal_criar" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Criar novo funil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="form_criar.reset()"></button>
            </div>
            <div class="modal-body">
                <form id="form_criar" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/criar-funil" site="backendMarte" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response+'. Entre em contato com o suporte.')" dmx-on:success="listar_funil.load({id_empresa_funil: usuario.data.query[0].empresa_selecionada});form_criar.reset();modal_criar.hide();notificacoes.success('Funil cadastrado com sucesso!')">
                    <div class="form-group mb-3"> <label for="nome_funil" class="form-label">Nome do funil</label>
                        <input type="text" class="form-control" id="nome_funil" name="nome_funil" aria-describedby="input1_help" required="" data-msg-required="Este é um campo obrigatório!">
                        <input type="hidden" class="form-control" id="id_empresa" name="id_empresa" aria-describedby="input1_help" dmx-bind:value="usuario.data.query[0].empresa_selecionada">
                        <input type="hidden" class="form-control" id="id_criado_por" name="id_criado_por" aria-describedby="input1_help" dmx-bind:value="usuario.data.query[0].id_usuarios">
                    </div>
                    <div class="form-group mb-3"> <label for="input2" class="form-label">Descrição</label>
                        <textarea id="descricao" class="form-control" style="min-height:120px" name="descricao"></textarea>
                    </div>
                    <div class="form-group mb-3"> <label for="input2" class="form-label">Time atrelado</label>
                        <select id="time" class="form-select" dmx-bind:options="listar_time.data.query_times" optiontext="nome_time" optionvalue="id_times" name="time" required="" data-msg-required="Este é um campo obrigatório!">
                            <option selected="" value="">Escolha um time</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" dmx-on:click="form_criar.reset()">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="form_criar.submit()">Cadastrar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="modal_editar" is="dmx-bs5-modal" tabindex="-1" nocloseonclick="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar funil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" dmx-on:click="form_criar.reset()"></button>
            </div>
            <div class="modal-body">
                <form id="form_criar1" is="dmx-serverconnect-form" method="post" action="http://localhost:3000/api/criar-funil" site="backendMarte" dmx-on:error="notificacoes.danger('Ocorreu um erro: '+lastError.status+lastError.message+lastError.response+'. Entre em contato com o suporte.')" dmx-on:success="listar_funil.load({id_empresa_funil: usuario.data.query[0].empresa_selecionada});form_criar.reset();modal_criar.hide();notificacoes.success('Funil cadastrado com sucesso!')">
                    <div class="form-group mb-3"> <label for="nome_funil1" class="form-label">Nome do funil</label>
                        <input type="text" class="form-control" id="nome_funil1" name="nome_funil" aria-describedby="input1_help" required="" data-msg-required="Este é um campo obrigatório!">
                        <input type="hidden" class="form-control" id="id_empresa1" name="id_empresa" aria-describedby="input1_help" dmx-bind:value="usuario.data.query[0].empresa_selecionada">
                        <input type="hidden" class="form-control" id="id_criado_por1" name="id_criado_por" aria-describedby="input1_help" dmx-bind:value="usuario.data.query[0].id_usuarios">
                    </div>
                    <div class="form-group mb-3"> <label for="input2" class="form-label">Descrição</label>
                        <textarea id="descricao1" class="form-control" style="min-height:120px" name="descricao"></textarea>
                    </div>
                    <div class="form-group mb-3"> <label for="input2" class="form-label">Time atrelado</label>
                        <select id="time1" class="form-select" dmx-bind:options="listar_time.data.query_times" optiontext="nome_time" optionvalue="id_times" name="time" required="" data-msg-required="Este é um campo obrigatório!">
                            <option selected="" value="">Escolha um time</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" dmx-on:click="form_criar.reset()">Cancelar</button>
                <button type="button" class="btn btn-primary" dmx-on:click="form_criar.submit()">Cadastrar</button>
            </div>
        </div>
    </div>
</div>
<header class="container-fluid header-azul-escuro align-self-center">
    <div class="container-fluid pt-5">
        <div class="row align-items-start">
            <div class="col align-self-center">
                <h3 class="m-0 text-white">Funil de vendas</h3>
            </div>
            <div class="col align-self-center text-end">
                <button id="btn2" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modal_criar">Adicionar</button>
            </div>
        </div>
    </div>
</header>
<main class="px-4">
    <div class="container-fluid bg-white rounded-4 p-4 container-minimo shadow">
        <div class="row" is="dmx-repeat" id="repeat_funil" dmx-bind:repeat="listar_funil.data.query_funil" key="id_board">
            <div class="col-4 p-3">
                <div class="card border-warning">
                    <div class="card-body">
                        <h3 class="card-title">{{nome_board}}</h3>
                        <p class="card-text">{{descricao_board}}</p>
                        <p class="card-text"><b>Time:</b> {{nome_time}}</p>
                        <a href="#" class="btn btn-warning me-2">Acessar funil</a>
                        <a href="#" class="btn btn-warning">Editar</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>